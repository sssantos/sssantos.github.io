<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Cindy Lai's STA 141B portfolio site">

    <title>Assignment 4 - Cindy Lai's Data Treasure Trove</title>

    <link rel="canonical" href="http://localhost:4000/2017/02/16/a4/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/clean-blog.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Cindy Lai's Data Treasure Trove" />

</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Cindy Lai's Data Treasure Trove</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/">Home</a>
                </li>
                
				
                <li>
                    <a href="/about/">About</a>
                </li>
				
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    <!-- Post Header -->
<header class="intro-header" style="background-image: url('/img/forest2.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>Assignment 4</h1>
                    
                    <h2 class="subheading">Working with APIs</h2>
                    
                    <span class="meta">Posted by Cindy Lai on February 16, 2017</span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

				<h1 id="assignment-4">Assignment 4</h1>

<p>In this assignment, you’ll combine the assignment 3 data set with nutrition data from the <a href="https://ndb.nal.usda.gov/ndb/search/list">USDA Food Composition Databases</a>. The CSV file <code class="highlighter-rouge">fresh.csv</code> contains the fresh fruits and vegetables data you extracted in assignment 3.</p>

<p>The USDA Food Composition Databases have a <a href="https://ndb.nal.usda.gov/ndb/doc/index">documented</a> web API that returns data in JSON format . You need a key in order to use the API. Only 1000 requests are allowed per hour, so it would be a good idea to use <a href="https://pypi.python.org/pypi/requests-cache">caching</a>.</p>

<p><a href="https://api.data.gov/signup/">Sign up for an API key here</a>. The key will work with any Data.gov API. You may need the key again later in the quarter, so make sure you save it.</p>

<p>These modules may be useful:</p>

<ul>
  <li><a href="http://docs.python-requests.org/en/master/user/quickstart/">requests</a></li>
  <li><a href="https://pypi.python.org/pypi/requests-cache">requests_cache</a></li>
  <li><a href="https://docs.python.org/2/library/urlparse.html">urlparse</a></li>
  <li><a href="http://pandas.pydata.org/pandas-docs/stable/">pandas</a></li>
</ul>

<p><strong>Exercise 1.1.</strong> Read the <a href="https://ndb.nal.usda.gov/ndb/doc/apilist/API-SEARCH.md">search request documentation</a>, then write a function called <code class="highlighter-rouge">ndb_search()</code> that makes a search request. The function should accept the search term as an argument. The function should return the search result items as a list (for 0 items, return an empty list).</p>

<p>Note that the search url is: <code class="highlighter-rouge">https://api.nal.usda.gov/ndb/search</code></p>

<p>As an example, a search for <code class="highlighter-rouge">"quail eggs"</code> should return this list:</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="p">[{</span><span class="s">u'ds'</span><span class="p">:</span> <span class="s">u'BL'</span><span class="p">,</span>
  <span class="s">u'group'</span><span class="p">:</span> <span class="s">u'Branded Food Products Database'</span><span class="p">,</span>
  <span class="s">u'name'</span><span class="p">:</span> <span class="s">u'CHAOKOH, QUAIL EGG IN BRINE, UPC: 044738074186'</span><span class="p">,</span>
  <span class="s">u'ndbno'</span><span class="p">:</span> <span class="s">u'45094707'</span><span class="p">,</span>
  <span class="s">u'offset'</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
 <span class="p">{</span><span class="s">u'ds'</span><span class="p">:</span> <span class="s">u'BL'</span><span class="p">,</span>
  <span class="s">u'group'</span><span class="p">:</span> <span class="s">u'Branded Food Products Database'</span><span class="p">,</span>
  <span class="s">u'name'</span><span class="p">:</span> <span class="s">u'L&amp;W, QUAIL EGGS, UPC: 024072000256'</span><span class="p">,</span>
  <span class="s">u'ndbno'</span><span class="p">:</span> <span class="s">u'45094890'</span><span class="p">,</span>
  <span class="s">u'offset'</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
 <span class="p">{</span><span class="s">u'ds'</span><span class="p">:</span> <span class="s">u'BL'</span><span class="p">,</span>
  <span class="s">u'group'</span><span class="p">:</span> <span class="s">u'Branded Food Products Database'</span><span class="p">,</span>
  <span class="s">u'name'</span><span class="p">:</span> <span class="s">u'BUDDHA, QUAIL EGGS IN BRINE, UPC: 761934535098'</span><span class="p">,</span>
  <span class="s">u'ndbno'</span><span class="p">:</span> <span class="s">u'45099560'</span><span class="p">,</span>
  <span class="s">u'offset'</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span>
 <span class="p">{</span><span class="s">u'ds'</span><span class="p">:</span> <span class="s">u'BL'</span><span class="p">,</span>
  <span class="s">u'group'</span><span class="p">:</span> <span class="s">u'Branded Food Products Database'</span><span class="p">,</span>
  <span class="s">u'name'</span><span class="p">:</span> <span class="s">u'GRAN SABANA, QUAIL EGGS, UPC: 819140010103'</span><span class="p">,</span>
  <span class="s">u'ndbno'</span><span class="p">:</span> <span class="s">u'45169279'</span><span class="p">,</span>
  <span class="s">u'offset'</span><span class="p">:</span> <span class="mi">3</span><span class="p">},</span>
 <span class="p">{</span><span class="s">u'ds'</span><span class="p">:</span> <span class="s">u'BL'</span><span class="p">,</span>
  <span class="s">u'group'</span><span class="p">:</span> <span class="s">u'Branded Food Products Database'</span><span class="p">,</span>
  <span class="s">u'name'</span><span class="p">:</span> <span class="s">u"D'ARTAGNAN, QUAIL EGGS, UPC: 736622102630"</span><span class="p">,</span>
  <span class="s">u'ndbno'</span><span class="p">:</span> <span class="s">u'45178254'</span><span class="p">,</span>
  <span class="s">u'offset'</span><span class="p">:</span> <span class="mi">4</span><span class="p">},</span>
 <span class="p">{</span><span class="s">u'ds'</span><span class="p">:</span> <span class="s">u'SR'</span><span class="p">,</span>
  <span class="s">u'group'</span><span class="p">:</span> <span class="s">u'Dairy and Egg Products'</span><span class="p">,</span>
  <span class="s">u'name'</span><span class="p">:</span> <span class="s">u'Egg, quail, whole, fresh, raw'</span><span class="p">,</span>
  <span class="s">u'ndbno'</span><span class="p">:</span> <span class="s">u'01140'</span><span class="p">,</span>
  <span class="s">u'offset'</span><span class="p">:</span> <span class="mi">5</span><span class="p">}]</span>
</code></pre>
</div>

<p>As usual, make sure you document and test your function.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">urllib2</span> <span class="kn">import</span> <span class="n">Request</span><span class="p">,</span> <span class="n">urlopen</span>
<span class="kn">from</span> <span class="nn">urlparse</span> <span class="kn">import</span> <span class="n">urlparse</span><span class="p">,</span> <span class="n">urlunparse</span>
<span class="kn">import</span> <span class="nn">requests</span><span class="o">,</span> <span class="nn">requests_cache</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">json</span>


<span class="c"># my API key</span>
<span class="n">key</span> <span class="o">=</span> <span class="s">"ULxnv6kWU0vTif6L3wHrB5MIkQKj0PrM3IfgfWbG"</span>
</code></pre>
</div>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">requests_cache</span><span class="o">.</span><span class="n">install_cache</span><span class="p">(</span><span class="s">'food_cache'</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>---------------------------------------------------------------------------

NameError                                 Traceback (most recent call last)

&lt;ipython-input-10-1e21dcdbe5e7&gt; in &lt;module&gt;()
----&gt; 1 requests_cache.install_cache('food_cache')


NameError: name 'requests_cache' is not defined
</code></pre>
</div>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># generate the query request to search for results</span>

<span class="c"># Notes: The request will return a JSON object. Default sort = "r", aka relevance</span>
<span class="c"># EXAMPLE URL: https://api.nal.usda.gov/ndb/search/?api_key=ULxnv6kWU0vTif6L3wHrB5MIkQKj0PrM3IfgfWbG&amp;format=json&amp;q=mushroom</span>

<span class="n">maxResults</span> <span class="o">=</span> <span class="mi">5</span>

<span class="k">def</span> <span class="nf">get_request</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">searchObject</span><span class="p">):</span>
    <span class="n">urlbase</span> <span class="o">=</span> <span class="s">"https://api.nal.usda.gov/ndb/search/"</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s">"q"</span><span class="p">:</span><span class="n">searchObject</span><span class="p">}</span>
    <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">"format"</span><span class="p">:</span><span class="s">"json"</span><span class="p">})</span>
    <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">"api_key"</span><span class="p">:</span><span class="n">key</span><span class="p">})</span>
    <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">"max"</span><span class="p">:</span><span class="n">maxResults</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">urlbase</span><span class="p">,</span><span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
<span class="n">get_request</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">"mushroom"</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>&lt;Response [200]&gt;
</code></pre>
</div>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">ndb_search</span><span class="p">(</span><span class="n">searchObject</span><span class="p">):</span>
    <span class="n">searchList</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">request</span> <span class="o">=</span> <span class="n">get_request</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">searchObject</span><span class="p">)</span>
    <span class="n">searchList</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">searchList</span><span class="p">[</span><span class="s">u'list'</span><span class="p">][</span><span class="s">u'item'</span><span class="p">]</span>

<span class="n">ndb_search</span><span class="p">(</span><span class="s">"mushroom"</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>[{u'ds': u'BL',
  u'group': u'Branded Food Products Database',
  u'name': u'MUSHROOM GRAVY MADE WITH REAL MUSHROOMS, UPC: 011213168265',
  u'ndbno': u'45077161',
  u'offset': 0},
 {u'ds': u'BL',
  u'group': u'Branded Food Products Database',
  u'name': u'BARTOLINI, EXTRA VIRGIN OLIVE OIL WITH MUSHROOM OIL, PORCINI MUSHROOM OIL, UPC: 657739001541',
  u'ndbno': u'45168655',
  u'offset': 1},
 {u'ds': u'BL',
  u'group': u'Branded Food Products Database',
  u'name': u'MUSHROOM HOUSE, DRIED OYSTER MUSHROOMS, UPC: 084348369166',
  u'ndbno': u'45184863',
  u'offset': 2},
 {u'ds': u'BL',
  u'group': u'Branded Food Products Database',
  u'name': u'MUSHROOM HOUSE, SHIITAKE DRIED MUSHROOMS, UPC: 084348374160',
  u'ndbno': u'45184864',
  u'offset': 3},
 {u'ds': u'BL',
  u'group': u'Branded Food Products Database',
  u'name': u'MUSHROOM HOUSE, DRIED MUSHROOMS, UPC: 084348396162',
  u'ndbno': u'45184865',
  u'offset': 4}]
</code></pre>
</div>

<p><strong>Exercise 1.2.</strong> Use your search function to get NDB numbers for the foods in the <code class="highlighter-rouge">fresh.csv</code> file. It’s okay if you don’t get an NDB number for every food, but try to come up with a strategy that gets most of them. Discuss your strategy in a short paragraph.</p>

<p>Hints:</p>

<ul>
  <li>The foods are all raw and unbranded.</li>
  <li>You can test search terms with the <a href="https://ndb.nal.usda.gov/ndb/search/list">online search page</a>.</li>
  <li>You can convert the output of <code class="highlighter-rouge">ndb_search()</code> to a data frame with <code class="highlighter-rouge">pd.DataFrame()</code>.</li>
  <li>The string methods for <a href="https://docs.python.org/2/library/stdtypes.html#string-methods">Python</a> and <a href="http://pandas.pydata.org/pandas-docs/stable/text.html#method-summary">Pandas</a> are useful here. It’s okay if you use <em>simple</em> regular expressions in the Pandas methods, although this exercise can be solved without them.</li>
  <li>You can merge data frames that have a column in common with <code class="highlighter-rouge">pd.merge()</code>.</li>
</ul>

<p>Note: I use both <b>raw_fresh</b> and <b>fresh</b> throughout the code. This was because I later updated the rows of fresh to sort by food name alphabetically, so it messed up the ordering. I use raw_fresh for the old index order.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">raw_fresh</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"fresh.csv"</span><span class="p">)</span>
<span class="n">fresh</span> <span class="o">=</span> <span class="n">raw_fresh</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span> <span class="o">=</span> <span class="s">"food"</span><span class="p">)</span>
<span class="n">fresh</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre>
</div>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>form</th>
      <th>price_per_lb</th>
      <th>yield</th>
      <th>lb_per_cup</th>
      <th>price_per_cup</th>
      <th>food</th>
      <th>type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>34</th>
      <td>Fresh1</td>
      <td>1.172248</td>
      <td>0.458554</td>
      <td>0.451948</td>
      <td>1.155360</td>
      <td>acorn_squash</td>
      <td>vegetables</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Fresh1</td>
      <td>1.567515</td>
      <td>0.900000</td>
      <td>0.242508</td>
      <td>0.422373</td>
      <td>apples</td>
      <td>fruit</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Fresh1</td>
      <td>3.040072</td>
      <td>0.930000</td>
      <td>0.363763</td>
      <td>1.189102</td>
      <td>apricots</td>
      <td>fruit</td>
    </tr>
    <tr>
      <th>44</th>
      <td>Fresh1</td>
      <td>2.213050</td>
      <td>0.375309</td>
      <td>0.385809</td>
      <td>2.274967</td>
      <td>artichoke</td>
      <td>vegetables</td>
    </tr>
    <tr>
      <th>24</th>
      <td>Fresh1</td>
      <td>3.213494</td>
      <td>0.493835</td>
      <td>0.396832</td>
      <td>2.582272</td>
      <td>asparagus</td>
      <td>vegetables</td>
    </tr>
  </tbody>
</table>
</div>

<p>After searching on the online page, I noticed the majority have the word are formatted “[fruit/vegetable], raw”, so I will adjust my search to include that in the parameter. Entries with more than one word are separted by a “, “.</p>

<p>In order to find the fresh fruit or vegetable you are looking for, I am modifying the search term to make it appear on top. Modifications include:</p>
<ul>
  <li>Adding '<b>, raw</b>' to the end of every entry</li>
  <li>Splitting multi-word entries with a comma</li>
  <li>Dealing with special cases</li>
</ul>

<p>I wrote a function called <b>modify_search_term</b> which will deal with multi-word entries by splitting them up and adding “raw” at the end of each term.
<b>check_if_found</b> makes sure that we get the item that we want. It goes to look into the food item’s group to make sure it belongs to the “Vegetables and Vegetable Products” group or the “Fruits and Fruit Juices” group, and not some branded entry.</p>

<p><b>grab_correct_entry</b> builds off check_if_found and goes through the search result list and returns the first entry which check_if_found is equal to <b>True</b>.</p>

<p>These functions culminate to <b>get_ndbno</b>, which takes an entry from the fresh.csv and outputs its corresponding nbd number.</p>

<p>The output is generated in the for loop, which creates a dictionary of foods and their ndb number. The for loop passes whenever get_ndb does not output a favorable result.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">modify_search_term</span><span class="p">(</span><span class="n">food</span><span class="p">):</span>
    <span class="n">searchTerm</span> <span class="o">=</span> <span class="n">food</span>
    <span class="k">if</span> <span class="s">"_"</span> <span class="ow">in</span> <span class="n">food</span><span class="p">:</span> <span class="c"># two+ word i.e. "collard_greens"</span>
        <span class="n">searchTerm</span> <span class="o">=</span> <span class="s">", "</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">food</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">'_'</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">searchTerm</span> <span class="o">+</span> <span class="s">", raw"</span>

<span class="n">modify_search_term</span><span class="p">(</span><span class="s">"lettuce_iceberg"</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>'lettuce, iceberg, raw'
</code></pre>
</div>

<p>Write something to deal with when the group isn’t <b>Vegetables and Vegetable Products</b> or <b>Fruits and Fruit Products</b>. Raise a flag to indicate that the raw fruit wasn’t found.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">check_if_found</span><span class="p">(</span><span class="n">foodJson</span><span class="p">):</span>
    <span class="n">foodGroup</span> <span class="o">=</span> <span class="n">foodJson</span><span class="p">[</span><span class="s">u'group'</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">foodGroup</span> <span class="o">==</span> <span class="s">u'Vegetables and Vegetable Products'</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">foodGroup</span> <span class="o">==</span> <span class="s">u'Fruits and Fruit Juices'</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
</code></pre>
</div>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">grab_correct_entry</span><span class="p">(</span><span class="n">jsonList</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">jsonList</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">check_if_found</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">result</span>
    <span class="k">return</span> <span class="bp">None</span>
</code></pre>
</div>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># main function to get ndb number</span>

<span class="k">def</span> <span class="nf">get_ndbno</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>
    <span class="n">searchTerm</span> <span class="o">=</span> <span class="n">modify_search_term</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
    <span class="n">searchResults</span> <span class="o">=</span> <span class="n">ndb_search</span><span class="p">(</span><span class="n">searchTerm</span><span class="p">)</span>  
    
    <span class="n">foodEntry</span> <span class="o">=</span> <span class="n">grab_correct_entry</span><span class="p">(</span><span class="n">searchResults</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">foodEntry</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="s">'NaN'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">foodEntry</span><span class="p">[</span><span class="s">'ndbno'</span><span class="p">]</span>
    
<span class="n">lettuce</span> <span class="o">=</span> <span class="n">get_ndbno</span><span class="p">(</span><span class="s">"lettuce_iceberg"</span><span class="p">)</span>
</code></pre>
</div>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">get_ndbno</span><span class="p">(</span><span class="s">'watermelon'</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>u'09326'
</code></pre>
</div>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># write a function to handle duplicates (cabbage and cucumbers)</span>
<span class="c"># input: takes the index for the row the food is located in raw_fresh</span>
<span class="c"># outputs new search term</span>
<span class="k">def</span> <span class="nf">look_for_details</span><span class="p">(</span><span class="n">ind</span><span class="p">):</span>
    <span class="n">freshForm</span> <span class="o">=</span> <span class="n">raw_fresh</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">detail</span> <span class="o">=</span> <span class="n">freshForm</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">" "</span><span class="p">)[</span><span class="mi">1</span><span class="p">:][</span><span class="mi">0</span><span class="p">]</span>
    <span class="c">#return detail</span>
    <span class="k">if</span> <span class="n">detail</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">detail</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">"1"</span><span class="p">:</span>
        <span class="n">detail</span> <span class="o">=</span> <span class="n">detail</span><span class="p">[:(</span><span class="nb">len</span><span class="p">(</span><span class="n">detail</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>
        
    <span class="k">return</span> <span class="n">fresh</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="s">'food'</span><span class="p">]</span> <span class="o">+</span> <span class="s">", "</span> <span class="o">+</span> <span class="n">detail</span>
    
<span class="n">look_for_details</span><span class="p">(</span><span class="mi">26</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>'cucumbers, peeled'
</code></pre>
</div>

<p>This function does not grab as many terms if I were to make it more specific. However, I kept it more general in case the data gets larger, so the look_for_details function would be able to grab more instances.</p>

<p>This goes through all of the food in the fresh csv. It tries to get all the ndb numbers by using the function get_ndbno(). If a duplicate is found, it will use the function look_for_details() and modify the term that you will be searching for (cabbage -&gt; red cabbage). Assumes that the first instance of duplicate pair will be original (uses cabbage) and 2nd will be a variation (red cabbage).</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">ndbNumbers</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">badRows</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">food</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">raw_fresh</span><span class="p">[</span><span class="s">'food'</span><span class="p">]):</span>
    <span class="k">if</span> <span class="n">food</span> <span class="ow">in</span> <span class="n">ndbNumbers</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> <span class="c"># duplicate</span>
        <span class="n">food</span> <span class="o">=</span> <span class="n">look_for_details</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ndbNumbers</span><span class="p">[</span><span class="n">food</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_ndbno</span><span class="p">(</span><span class="n">food</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">badRows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="k">pass</span>
</code></pre>
</div>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">ndbNumbers</span> <span class="c"># didn't get kiwi, and cucumbers is wrong (not the consumed with peel)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="err">'acorn_squash':</span><span class="w"> </span><span class="err">u'11482',</span><span class="w">
 </span><span class="err">'apples':</span><span class="w"> </span><span class="err">u'09003',</span><span class="w">
 </span><span class="err">'apricots':</span><span class="w"> </span><span class="err">u'09021',</span><span class="w">
 </span><span class="err">'artichoke':</span><span class="w"> </span><span class="err">u'11226',</span><span class="w">
 </span><span class="err">'asparagus':</span><span class="w"> </span><span class="err">u'11011',</span><span class="w">
 </span><span class="err">'avocados':</span><span class="w"> </span><span class="err">u'09038',</span><span class="w">
 </span><span class="err">'bananas':</span><span class="w"> </span><span class="err">u'09040',</span><span class="w">
 </span><span class="err">'blackberries':</span><span class="w"> </span><span class="err">u'09042',</span><span class="w">
 </span><span class="err">'blueberries':</span><span class="w"> </span><span class="err">u'09050',</span><span class="w">
 </span><span class="err">'brussels_sprouts':</span><span class="w"> </span><span class="err">u'11098',</span><span class="w">
 </span><span class="err">'butternut_squash':</span><span class="w"> </span><span class="err">u'11485',</span><span class="w">
 </span><span class="err">'cabbage':</span><span class="w"> </span><span class="err">u'11503',</span><span class="w">
 </span><span class="err">'cabbage,</span><span class="w"> </span><span class="err">red':</span><span class="w"> </span><span class="err">u'11112',</span><span class="w">
 </span><span class="err">'cantaloupe':</span><span class="w"> </span><span class="err">u'09181',</span><span class="w">
 </span><span class="err">'cherries':</span><span class="w"> </span><span class="err">u'09276',</span><span class="w">
 </span><span class="err">'collard_greens':</span><span class="w"> </span><span class="err">u'11161',</span><span class="w">
 </span><span class="err">'corn_sweet':</span><span class="w"> </span><span class="err">u'11900',</span><span class="w">
 </span><span class="err">'cucumbers':</span><span class="w"> </span><span class="err">u'11206',</span><span class="w">
 </span><span class="err">'cucumbers,</span><span class="w"> </span><span class="err">peeled':</span><span class="w"> </span><span class="err">u'11206',</span><span class="w">
 </span><span class="err">'grapefruit':</span><span class="w"> </span><span class="err">u'09117',</span><span class="w">
 </span><span class="err">'grapes':</span><span class="w"> </span><span class="err">u'09129',</span><span class="w">
 </span><span class="err">'green_beans':</span><span class="w"> </span><span class="err">u'11052',</span><span class="w">
 </span><span class="err">'green_peppers':</span><span class="w"> </span><span class="err">u'11333',</span><span class="w">
 </span><span class="err">'honeydew':</span><span class="w"> </span><span class="err">u'09184',</span><span class="w">
 </span><span class="err">'kale':</span><span class="w"> </span><span class="err">u'11233',</span><span class="w">
 </span><span class="err">'lettuce_iceberg':</span><span class="w"> </span><span class="err">u'11252',</span><span class="w">
 </span><span class="err">'mangoes':</span><span class="w"> </span><span class="err">u'09176',</span><span class="w">
 </span><span class="err">'mustard_greens':</span><span class="w"> </span><span class="err">u'11270',</span><span class="w">
 </span><span class="err">'nectarines':</span><span class="w"> </span><span class="err">u'09191',</span><span class="w">
 </span><span class="err">'okra':</span><span class="w"> </span><span class="err">u'11278',</span><span class="w">
 </span><span class="err">'onions':</span><span class="w"> </span><span class="err">u'11282',</span><span class="w">
 </span><span class="err">'oranges':</span><span class="w"> </span><span class="err">u'09201',</span><span class="w">
 </span><span class="err">'papaya':</span><span class="w"> </span><span class="err">u'09226',</span><span class="w">
 </span><span class="err">'peaches':</span><span class="w"> </span><span class="err">u'09236',</span><span class="w">
 </span><span class="err">'pears':</span><span class="w"> </span><span class="err">u'09252',</span><span class="w">
 </span><span class="err">'pineapple':</span><span class="w"> </span><span class="err">u'09266',</span><span class="w">
 </span><span class="err">'plums':</span><span class="w"> </span><span class="err">u'09279',</span><span class="w">
 </span><span class="err">'pomegranate':</span><span class="w"> </span><span class="err">u'09286',</span><span class="w">
 </span><span class="err">'potatoes':</span><span class="w"> </span><span class="err">u'11362',</span><span class="w">
 </span><span class="err">'radish':</span><span class="w"> </span><span class="err">u'11429',</span><span class="w">
 </span><span class="err">'raspberries':</span><span class="w"> </span><span class="err">u'09302',</span><span class="w">
 </span><span class="err">'red_peppers':</span><span class="w"> </span><span class="err">u'11821',</span><span class="w">
 </span><span class="err">'strawberries':</span><span class="w"> </span><span class="err">u'09316',</span><span class="w">
 </span><span class="err">'summer_squash':</span><span class="w"> </span><span class="err">u'11475',</span><span class="w">
 </span><span class="err">'sweet_potatoes':</span><span class="w"> </span><span class="err">u'11507',</span><span class="w">
 </span><span class="err">'tangerines':</span><span class="w"> </span><span class="err">u'09221',</span><span class="w">
 </span><span class="err">'turnip_greens':</span><span class="w"> </span><span class="err">u'11568',</span><span class="w">
 </span><span class="err">'watermelon':</span><span class="w"> </span><span class="err">u'09326'</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">ndb_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ndbNumbers</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">ndbNumbers</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s">'ndbNo'</span><span class="p">])</span>
<span class="n">ndb_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre>
</div>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ndbNo</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>red_peppers</th>
      <td>11821</td>
    </tr>
    <tr>
      <th>bananas</th>
      <td>09040</td>
    </tr>
    <tr>
      <th>lettuce_iceberg</th>
      <td>11252</td>
    </tr>
    <tr>
      <th>radish</th>
      <td>11429</td>
    </tr>
    <tr>
      <th>corn_sweet</th>
      <td>11900</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">ndb_df</span> <span class="o">=</span> <span class="n">ndb_df</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
<span class="n">ndb_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre>
</div>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ndbNo</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>acorn_squash</th>
      <td>11482</td>
    </tr>
    <tr>
      <th>apples</th>
      <td>09003</td>
    </tr>
    <tr>
      <th>apricots</th>
      <td>09021</td>
    </tr>
    <tr>
      <th>artichoke</th>
      <td>11226</td>
    </tr>
    <tr>
      <th>asparagus</th>
      <td>11011</td>
    </tr>
  </tbody>
</table>
</div>

<p><strong>Exercise 1.3.</strong> Read the <a href="https://ndb.nal.usda.gov/ndb/doc/apilist/API-FOOD-REPORTV2.md">food reports V2 documentation</a>, then write a function called <code class="highlighter-rouge">ndb_report()</code> that requests a <em>basic</em> food report. The function should accept the NDB number as an argument and return the list of nutrients for the food.</p>

<p>Note that the report url is: <code class="highlighter-rouge">https://api.nal.usda.gov/ndb/V2/reports</code></p>

<p>For example, for <code class="highlighter-rouge">"09279"</code> (raw plums) the first element of the returned list should be:</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="s">u'group'</span><span class="p">:</span> <span class="s">u'Proximates'</span><span class="p">,</span>
 <span class="s">u'measures'</span><span class="p">:</span> <span class="p">[{</span><span class="s">u'eqv'</span><span class="p">:</span> <span class="mf">165.0</span><span class="p">,</span>
   <span class="s">u'eunit'</span><span class="p">:</span> <span class="s">u'g'</span><span class="p">,</span>
   <span class="s">u'label'</span><span class="p">:</span> <span class="s">u'cup, sliced'</span><span class="p">,</span>
   <span class="s">u'qty'</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
   <span class="s">u'value'</span><span class="p">:</span> <span class="s">u'143.93'</span><span class="p">},</span>
  <span class="p">{</span><span class="s">u'eqv'</span><span class="p">:</span> <span class="mf">66.0</span><span class="p">,</span>
   <span class="s">u'eunit'</span><span class="p">:</span> <span class="s">u'g'</span><span class="p">,</span>
   <span class="s">u'label'</span><span class="p">:</span> <span class="s">u'fruit (2-1/8" dia)'</span><span class="p">,</span>
   <span class="s">u'qty'</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
   <span class="s">u'value'</span><span class="p">:</span> <span class="s">u'57.57'</span><span class="p">},</span>
  <span class="p">{</span><span class="s">u'eqv'</span><span class="p">:</span> <span class="mf">151.0</span><span class="p">,</span>
   <span class="s">u'eunit'</span><span class="p">:</span> <span class="s">u'g'</span><span class="p">,</span>
   <span class="s">u'label'</span><span class="p">:</span> <span class="s">u'NLEA serving'</span><span class="p">,</span>
   <span class="s">u'qty'</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
   <span class="s">u'value'</span><span class="p">:</span> <span class="s">u'131.72'</span><span class="p">}],</span>
 <span class="s">u'name'</span><span class="p">:</span> <span class="s">u'Water'</span><span class="p">,</span>
 <span class="s">u'nutrient_id'</span><span class="p">:</span> <span class="s">u'255'</span><span class="p">,</span>
 <span class="s">u'unit'</span><span class="p">:</span> <span class="s">u'g'</span><span class="p">,</span>
 <span class="s">u'value'</span><span class="p">:</span> <span class="s">u'87.23'</span><span class="p">}</span>
</code></pre>
</div>

<p>Be sure to document and test your function.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">ndb_report</span><span class="p">(</span><span class="n">ndbNumber</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s">"https://api.nal.usda.gov/ndb/V2/reports/"</span>
    <span class="n">querystring</span> <span class="o">=</span> <span class="p">{</span><span class="s">"ndbno"</span><span class="p">:</span><span class="n">ndbNumber</span><span class="p">,</span><span class="s">"api_key"</span><span class="p">:</span><span class="s">"ULxnv6kWU0vTif6L3wHrB5MIkQKj0PrM3IfgfWbG"</span><span class="p">,</span><span class="s">"format"</span><span class="p">:</span><span class="s">"json"</span><span class="p">,</span><span class="s">"type"</span><span class="p">:</span><span class="s">"b"</span><span class="p">}</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">querystring</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s">u'foods'</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s">'food'</span><span class="p">][</span><span class="s">'nutrients'</span><span class="p">]</span>
</code></pre>
</div>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">ndb_report</span><span class="p">(</span><span class="mi">11112</span><span class="p">)</span> <span class="c"># red cabbage</span>
</code></pre>
</div>

<p><strong>Exercise 1.4.</strong> Which foods provide the best combination of price, yield, and nutrition? You can use kilocalories as a measure of “nutrition” here, but more a detailed analysis is better. Use plots to support your analysis.</p>

<p>I based off what is “healthy” from Energy (kcal), Fiber, Sugars (negative health), and Vitamin C. I used the formula:
<b>health = energy + fiber + vitaminC - sugars/2</b></p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">prices</span> <span class="o">=</span> <span class="n">fresh</span><span class="p">[</span><span class="s">'price_per_lb'</span><span class="p">]</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">fresh</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">priceList</span> <span class="o">=</span> <span class="n">prices</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">good_prices</span> <span class="o">=</span> <span class="p">[</span><span class="n">priceList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">priceList</span><span class="p">))</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">badRows</span><span class="p">]</span> 
<span class="c"># note! this does enter the wrong price for cucumbers, with peel</span>

<span class="n">ndb_df</span><span class="p">[</span><span class="s">'price per lb'</span><span class="p">]</span> <span class="o">=</span> <span class="n">good_prices</span>
</code></pre>
</div>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">types</span> <span class="o">=</span> <span class="n">fresh</span><span class="p">[</span><span class="s">'type'</span><span class="p">]</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">fresh</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">typeList</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">good_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">typeList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">typeList</span><span class="p">))</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">badRows</span><span class="p">]</span> 

<span class="n">ndb_df</span><span class="p">[</span><span class="s">'type'</span><span class="p">]</span> <span class="o">=</span> <span class="n">good_types</span>
</code></pre>
</div>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">ndb_df</span><span class="p">[</span><span class="s">"Nutrients"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ndb_report</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ndb_df</span><span class="p">[</span><span class="s">'ndbNo'</span><span class="p">]]</span>
</code></pre>
</div>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">nut_keys</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span>
            <span class="c"># energy, sugars, fiber, vitamin C</span>


<span class="c"># takes in a nutrition report and a nut_keys index, and returns the nutrient value</span>
<span class="k">def</span> <span class="nf">nutrient_info_extractor</span><span class="p">(</span><span class="n">food</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">food</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="s">'value'</span><span class="p">])</span>

<span class="n">ndb_df</span><span class="p">[</span><span class="s">'energy'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">nutrient_info_extractor</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">nut_keys</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">fd</span> <span class="ow">in</span> <span class="n">ndb_df</span><span class="p">[</span><span class="s">"Nutrients"</span><span class="p">]]</span>
<span class="n">ndb_df</span><span class="p">[</span><span class="s">'sugar'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">nutrient_info_extractor</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">nut_keys</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">fd</span> <span class="ow">in</span> <span class="n">ndb_df</span><span class="p">[</span><span class="s">"Nutrients"</span><span class="p">]]</span>
<span class="n">ndb_df</span><span class="p">[</span><span class="s">'fiber'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">nutrient_info_extractor</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">nut_keys</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="k">for</span> <span class="n">fd</span> <span class="ow">in</span> <span class="n">ndb_df</span><span class="p">[</span><span class="s">"Nutrients"</span><span class="p">]]</span>
<span class="n">ndb_df</span><span class="p">[</span><span class="s">'vitamin C'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">nutrient_info_extractor</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">nut_keys</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="k">for</span> <span class="n">fd</span> <span class="ow">in</span> <span class="n">ndb_df</span><span class="p">[</span><span class="s">"Nutrients"</span><span class="p">]]</span>
</code></pre>
</div>

<h4>Heath Index</h4>
<p>Now I calculate the “health index”, which takes calories, fiber, vitamin C, and sugars into consideration. I chose these elements because these are some very common nutrients, known to the general public. People usually want fibers and high in vitamin C, and want to stay away from sugars (sugars is my penalty term).
In addition, I consulted a couple of nutrition articles to see what they usually rate as a nutritional food. I wanted to keep the index simple, so I did not include many variables. &lt;p&gt;
<i>Note:</i>I divided sugars by 2, so it won’t have such a dramatic impact on the health index.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">ndb_df</span><span class="p">[</span><span class="s">'health index'</span><span class="p">]</span> <span class="o">=</span> <span class="n">ndb_df</span><span class="p">[</span><span class="s">'energy'</span><span class="p">]</span> <span class="o">+</span> <span class="n">ndb_df</span><span class="p">[</span><span class="s">'fiber'</span><span class="p">]</span> <span class="o">+</span> <span class="n">ndb_df</span><span class="p">[</span><span class="s">'vitamin C'</span><span class="p">]</span> <span class="o">-</span> <span class="n">ndb_df</span><span class="p">[</span><span class="s">'sugar'</span><span class="p">]</span><span class="o">/</span><span class="mf">2.0</span>
</code></pre>
</div>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">ndb_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre>
</div>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ndbNo</th>
      <th>price per lb</th>
      <th>Nutrients</th>
      <th>energy</th>
      <th>sugar</th>
      <th>fiber</th>
      <th>vitamin C</th>
      <th>health index</th>
      <th>type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>acorn_squash</th>
      <td>11482</td>
      <td>1.172248</td>
      <td>[{u'group': u'Proximates', u'name': u'Water', ...</td>
      <td>40.0</td>
      <td>33.00</td>
      <td>1.5</td>
      <td>0.14</td>
      <td>25.140</td>
      <td>vegetables</td>
    </tr>
    <tr>
      <th>apples</th>
      <td>09003</td>
      <td>1.567515</td>
      <td>[{u'group': u'Proximates', u'name': u'Water', ...</td>
      <td>52.0</td>
      <td>10.39</td>
      <td>2.4</td>
      <td>4.60</td>
      <td>53.805</td>
      <td>fruit</td>
    </tr>
    <tr>
      <th>apricots</th>
      <td>09021</td>
      <td>3.040072</td>
      <td>[{u'group': u'Proximates', u'name': u'Water', ...</td>
      <td>48.0</td>
      <td>9.24</td>
      <td>2.0</td>
      <td>10.00</td>
      <td>55.380</td>
      <td>fruit</td>
    </tr>
    <tr>
      <th>artichoke</th>
      <td>11226</td>
      <td>2.213050</td>
      <td>[{u'group': u'Proximates', u'name': u'Water', ...</td>
      <td>73.0</td>
      <td>9.60</td>
      <td>1.6</td>
      <td>4.00</td>
      <td>73.800</td>
      <td>vegetables</td>
    </tr>
    <tr>
      <th>asparagus</th>
      <td>11011</td>
      <td>3.213494</td>
      <td>[{u'group': u'Proximates', u'name': u'Water', ...</td>
      <td>20.0</td>
      <td>1.88</td>
      <td>2.1</td>
      <td>5.60</td>
      <td>26.760</td>
      <td>vegetables</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">seaborn</span> <span class="kn">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="n">chart1</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">'price per lb'</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">'health index'</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">ndb_df</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">fit_reg</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">scatter_kws</span><span class="o">=</span><span class="p">{</span><span class="s">'s'</span><span class="p">:</span><span class="mi">30</span><span class="p">})</span>

<span class="n">sns</span><span class="o">.</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">'Health Index (kcal, sugars, Vitamin C, fiber) vs. Price'</span><span class="p">)</span>

<span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ndb_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">ndb_df</span><span class="p">[</span><span class="s">'price per lb'</span><span class="p">],</span> <span class="n">ndb_df</span><span class="p">[</span><span class="s">'health index'</span><span class="p">]):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
        <span class="n">label</span><span class="p">,</span>
        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">ha</span><span class="o">=</span><span class="s">'center'</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s">'bottom'</span><span class="p">,</span>
        <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s">'round,pad=0.1'</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">))</span>
    
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="c"># plotting price vs. health index</span>
</code></pre>
</div>

<p><img src="output_38_0.png" alt="png" /></p>

<p>If we base value off of price and what is considered ‘nutritious’ (health index), then according to the plot above, we should look at the foods in the <b>top left</b> region. We can see</p>
<ul>
  <li>avocados</li>
  <li>kale</li>
  <li>red peppers</li>
  <li>brussels spouts</li>
</ul>

<p>in the top rankings.
Some other interesting foods to point out are <b>raspberries</b>, which stand out as a very expensive food with mediocre nutritional value. The berries in general are on the right, with mediocre health indices. <b>Green Cabbage</b> <i>(labled as cabbage in the graph)</i> is rather cheap, but surprisingly not that healthy (with a negative index).</p>

<p>If you generally care more for price, you should look at the left side. <b>Green peppers</b>, <b>pineapples</b>, <b>sweet potatoes</b> are some cheap, high in nutrient foods.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">chart2</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">'price per lb'</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">'energy'</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">ndb_df</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">fit_reg</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">scatter_kws</span><span class="o">=</span><span class="p">{</span><span class="s">'s'</span><span class="p">:</span><span class="mi">30</span><span class="p">})</span>
<span class="n">sns</span><span class="o">.</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">'Energy (kcal) vs. Price'</span><span class="p">)</span>

<span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ndb_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">ndb_df</span><span class="p">[</span><span class="s">'price per lb'</span><span class="p">],</span> <span class="n">ndb_df</span><span class="p">[</span><span class="s">'energy'</span><span class="p">]):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
        <span class="n">label</span><span class="p">,</span>
        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">ha</span><span class="o">=</span><span class="s">'center'</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s">'bottom'</span><span class="p">,</span>
        <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s">'round,pad=0.1'</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre>
</div>

<p><img src="output_40_0.png" alt="png" /></p>

<p>When we take a simpler approach and simply base nutrition off of Energy (kcal), then you can see that <b>avocados</b> definitely takes the lead.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">chart3</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">FacetGrid</span><span class="p">(</span><span class="n">ndb_df</span><span class="p">,</span> <span class="n">hue</span> <span class="o">=</span> <span class="s">"type"</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">chart3</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">,</span> <span class="s">"price per lb"</span><span class="p">,</span> <span class="s">"energy"</span><span class="p">)</span><span class="o">.</span><span class="n">add_legend</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">'Energy (kcal) vs. Price'</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre>
</div>

<p><img src="output_42_0.png" alt="png" /></p>

<p>There is not really a differennce between fruits and vegetables for calories.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="s">"health index"</span><span class="p">,</span> <span class="s">"type"</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">ndb_df</span><span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">'Distribution of Health, Vegetables vs. Fruit'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre>
</div>

<p><img src="output_44_0.png" alt="png" /></p>

<p>Fruits have a more limited range of health, but have a higher average health index than vegetables.</p>

<p>Sites used:</p>
<ul>
  <li>http://stackoverflow.com/questions/5188792/how-to-check-a-string-for-specific-characters</li>
  <li>http://www.pythonforbeginners.com/dictionary/python-split</li>
  <li>http://stackoverflow.com/questions/5438745/python-nan-and-inf-values</li>
  <li>http://stackoverflow.com/questions/8312829/how-to-remove-item-from-a-python-list-if-a-condition-is-true</li>
  <li>http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.sort_index.html</li>
  <li>http://stackoverflow.com/questions/30009948/how-to-reorder-indexed-rows-based-on-a-list-in-pandas-data-frame</li>
  <li>http://stackoverflow.com/questions/5147112/matplotlib-how-to-put-individual-tags-for-a-scatter-plot</li>
</ul>


                <hr>

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2017/02/05/a3/" data-toggle="tooltip" data-placement="top" title="Assignment 3">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2017/02/25/a5/" data-toggle="tooltip" data-placement="top" title="Assignment 5">Next Post &rarr;</a>
                    </li>
                    
                </ul>

            </div>
        </div>
    </div>
</article>

<hr>


    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    <li>
                        <a href="https://github.com/laic5">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="mailto:CynthiaLai1996@gmail.com">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="copyright text-muted">Copyright &copy;  2017</p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/clean-blog.min.js "></script>


    


</body>

</html>
